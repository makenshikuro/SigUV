_data="",_nivelActual="0",centro=[39.512859,-.4244782],_currentPosition=centro,_zoom=18,_fondo="plano",_tema="b",_iconos=!0,_toponimo="d",_area="";var surOeste=new L.LatLng(39.51178034700101,-.4247921705245971),norEste=new L.LatLng(39.51368822239936,-.42276978492736816);_mapBounds=new L.LatLngBounds(surOeste,norEste),_mapMinZoom=5,_mapMaxZoom=25,map=L.map("map",{center:centro,zoom:_zoom,zoomControl:!1});var osmUrl="http://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png";osm=L.tileLayer(osmUrl,{maxZoom:21}).addTo(map),_topRight=!1,_topLeft=!1,_bottomLeft=!1;var overlay,bounds,inputTopLeft=$("#map-editor\\:getTopLeft"),inputTopRight=$("#map-editor\\:getTopRight"),inputBottomLeft=$("#map-editor\\:getBottomLeft"),inputLocalizacion=$("#map-editor\\:getLocalizacion"),modo=$("#map-editor\\:testMap").data("modo"),topLeftMarker=!1,topRightMarker=!1,bottomLeftMarker=!1;function addTopLeft(){_topLeft=!0}function addTopRight(){_topRight=!0}function addBottonLeft(){_bottomLeft=!0}function onMapClick(t){_topLeft&&(topLeftMarker&&map.removeLayer(topLeftMarker),pointTopLeft=L.latLng(t.latlng),topLeftMarker=L.marker(t.latlng,{draggable:!0,title:"Resource location",alt:"Resource Location",riseOnHover:!0}).addTo(map).bindPopup("TopLeft "+t.latlng.toString()).openPopup(),_topLeft=!1,inputTopLeft.val(t.latlng.lat+","+t.latlng.lng),generarMapa()),_topRight&&(topRightMarker&&map.removeLayer(topRightMarker),pointTopRight=L.latLng(t.latlng),topRightMarker=L.marker(t.latlng,{draggable:!0,title:"Resource location",alt:"Resource Location",riseOnHover:!0}).addTo(map).bindPopup("TopRight"+t.latlng.toString()).openPopup(),_topRight=!1,inputTopRight.val(t.latlng.lat+","+t.latlng.lng),generarMapa()),_bottomLeft&&(bottomLeftMarker&&map.removeLayer(bottomLeftMarker),pointBottomLeft=L.latLng(t.latlng),bottomLeftMarker=L.marker(t.latlng,{draggable:!0,title:"Resource location",alt:"Resource Location",riseOnHover:!0}).addTo(map).bindPopup("BottomLeft "+t.latlng.toString()).openPopup(),_bottomLeft=!1,inputBottomLeft.val(t.latlng.lat+","+t.latlng.lng),generarMapa())}function generarMapa(){topLeftMarker&&topRightMarker&&bottomLeftMarker&&(overlay&&map.removeLayer(overlay),bounds=new L.LatLngBounds(pointTopLeft,pointTopRight).extend(pointBottomLeft),inputLocalizacion.val(bounds.getCenter().lat+","+bounds.getCenter().lng),console.log(inputLocalizacion),map.fitBounds(bounds),overlay=L.imageOverlay.rotated("//localhost/"+$("#map-editor\\:testMap").val(),pointTopLeft,pointTopRight,pointBottomLeft,{opacity:.8,interactive:!0}),topLeftMarker.on("drag dragend",repositionImage),topRightMarker.on("drag dragend",repositionImage),bottomLeftMarker.on("drag dragend",repositionImage),map.addLayer(overlay))}function repositionImage(){L.latLng(topLeftMarker.getLatLng().lat,topLeftMarker.getLatLng().lng),L.latLng(topRightMarker.getLatLng().lat,topRightMarker.getLatLng().lng),L.latLng(bottomLeftMarker.getLatLng().lat,bottomLeftMarker.getLatLng().lng);inputTopLeft.val(topLeftMarker.getLatLng().lat+","+topLeftMarker.getLatLng().lng),inputTopRight.val(topRightMarker.getLatLng().lat+","+topRightMarker.getLatLng().lng),inputBottomLeft.val(bottomLeftMarker.getLatLng().lat+","+bottomLeftMarker.getLatLng().lng),inputLocalizacion.val(bounds.getCenter().lat+","+bounds.getCenter().lng),overlay.reposition(topLeftMarker.getLatLng(),topRightMarker.getLatLng(),bottomLeftMarker.getLatLng())}if("editor"!==modo)L.easyButton("fa-2x fas fa-map-marker-alt planoMarker topleft",function(t,o){addTopLeft()},"Punto superior izquierda").addTo(map),L.easyButton("fa-2x fas fa-map-marker-alt planoMarker topright",function(t,o){addTopRight()},"Punto superior derecha").addTo(map),L.easyButton("fa-2x fas fa-map-marker-alt planoMarker bottomleft",function(t,o){addBottonLeft()},"Punto inferior izquierda").addTo(map),map.on("click",onMapClick),console.log($("#map-editor\\:testMap").data("modo"));else{console.log($("#map-editor\\:testMap").data("modo"));inputTopLeft=$("#map-editor\\:testMap").data("ptl"),inputTopRight=$("#map-editor\\:testMap").data("ptr"),inputBottomLeft=$("#map-editor\\:testMap").data("pbl");var pointTopLeft=L.latLng(inputTopLeft.split(",")[0],inputTopLeft.split(",")[1]),pointTopRight=L.latLng(inputTopRight.split(",")[0],inputTopRight.split(",")[1]),pointBottomLeft=L.latLng(inputBottomLeft.split(",")[0],inputBottomLeft.split(",")[1]);bounds=new L.LatLngBounds(pointTopLeft,pointTopRight).extend(pointBottomLeft),inputLocalizacion.val(bounds.getCenter().lat+","+bounds.getCenter().lng),map.fitBounds(bounds),overlay=L.imageOverlay.rotated("//"+location.hostname+"/"+$("#map-editor\\:testMap").val(),pointTopLeft,pointTopRight,pointBottomLeft,{opacity:.8}),map.addLayer(overlay)}function changeMap(t){map.removeLayer(overlay),overlay=L.imageOverlay.rotated("//"+location.hostname+"/planos/"+t.value,pointTopLeft,pointTopRight,pointBottomLeft,{opacity:.8,interactive:!0}),map.addLayer(overlay),bounds=new L.LatLngBounds(pointTopLeft,pointTopRight).extend(pointBottomLeft),map.fitBounds(bounds),console.log(t.value)}